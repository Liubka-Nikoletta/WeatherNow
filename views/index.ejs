<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WeatherNow</title>
    <meta name="description" content="–î–µ—Ç–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥–∏ –Ω–∞ 5 –¥–Ω—ñ–≤ –¥–ª—è –≤–∞—à–æ–≥–æ –º—ñ—Å—Ç–∞">
    <meta name="keywords" content="–ø–æ–≥–æ–¥–∞, –ø—Ä–æ–≥–Ω–æ–∑, 5 –¥–Ω—ñ–≤, –º—ñ—Å—Ç–æ, WeatherNow">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/img.png" type="image/x-icon">
</head>
<body>
<% const emojiMap = {
    'light rain': 'üå¶Ô∏è',
    'moderate rain': 'üåßÔ∏è',
    'heavy intensity rain': 'üåßÔ∏è',
    'very heavy rain': 'üåßÔ∏è',
    'extreme rain': 'üåßÔ∏è',
    'freezing rain': '‚ùÑÔ∏è',
    'light snow': 'üå®Ô∏è',
    'overcast clouds': '‚òÅÔ∏è',
    'scattered clouds': 'üå•Ô∏è',
    'broken clouds': 'üå•Ô∏è',
    'few clouds': '‚õÖ',
    'clear sky': '‚òÄÔ∏è',
    'mist': 'üå´Ô∏è',

    'Thunderstorm': '‚õàÔ∏è',
    'Drizzle': 'üå¶Ô∏è',
    'Rain': 'üåßÔ∏è',
    'Snow': '‚ùÑÔ∏è',
    'Clear': '‚òÄÔ∏è',
    'Clouds': '‚òÅÔ∏è',
    'Mist': 'üå´Ô∏è',
    'Smoke': 'üå´Ô∏è',
    'Haze': 'üå´Ô∏è',
    'Dust': 'üå´Ô∏è',
    'Fog': 'üå´Ô∏è',
    'Sand': 'üå´Ô∏è',
    'Ash': 'üåã',
    'Squall': 'üå¨Ô∏è',
    'Tornado': 'üå™Ô∏è'
}; %>
<% if(typeof error != 'undefined'){ %>
    <div  class="toast-container" id="errorToastContainer"></div>
<% } %>
<div class="container">
    <header>
        <h1>üå§Ô∏è WeatherNow</h1>
        <p class="subtitle">–î–µ—Ç–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥–∏ –Ω–∞ 5 –¥–Ω—ñ–≤</p>
    </header>
    <main>
        <section class="search-section">
            <form action="/weather" method="POST" class="search-section-grid">
                <label for="cityInput" class="sr-only"></label>
                <input
                        name="city"
                        id="cityInput"
                        type="text"
                        class="search-section-item search-input"
                        placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –õ—å–≤—ñ–≤, –ö–∏—ó–≤, –û–¥–µ—Å–∞...)"
                        required
                >
                <button type="submit" class="search-section-item search-btn">üîç<span
                            class="btn-text"> –î—ñ–∑–Ω–∞—Ç–∏—Å—è –ø–æ–≥–æ–¥—É</span></button>
            </form>
        </section>
        <div id="weatherResults">
            <section class="weather-results">
                <% if (typeof forecast !== 'undefined') { %>
                    <h2 class="city-name" id="cityName"><%= city %></h2>
                    <div class="forecast-grid">
                        <% forecast.forEach(day => { %>
                            <article class="day-card">
                                <div class="day-header">
                                    <div class="day-name">
                                        <%= new Date(day.dt * 1000).toLocaleString("uk-UA", {weekday: 'long'}) %>
                                    </div>
                                    <div class="day-date">
                                        <%= new Date(day.dt * 1000).toLocaleString("uk-UA", {
                                            day: '2-digit',
                                            month: 'long'
                                        }) %>
                                    </div>
                                </div>

                                <div class="weather-icon">
                                    <%= emojiMap[day.weather[0].description.toLowerCase()] || emojiMap[day.weather[0].main] || '‚ùì' %>
                                </div>

                                <div class="temperature">
                                    <div class="temp-main">
                                        <%= Math.round(day.temp_avg - 273.15) %>¬∞C
                                    </div>
                                    <div class="temp-range">
                                        <%= Math.round(day.temp_min - 273.15) %>¬∞ / <%= Math.round(day.temp_max - 273.15) %>
                                        ¬∞
                                    </div>
                                </div>

                                <div class="weather-description">
                                    <%= day.weather[0].description.charAt(0).toUpperCase() + day.weather[0].description.slice(1) %>
                                </div>

                                <div class="weather-details">
                                    <div class="detail-item">
                                        <div class="detail-label">–í–æ–ª–æ–≥—ñ—Å—Ç—å</div>
                                        <div class="detail-value"><%= Math.round(day.humidity_avg) %>%</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">–ô–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –æ–ø–∞–¥—ñ–≤</div>
                                        <div class="detail-value"><%= Math.round(day.pop_avg * 100) %>%</div>
                                    </div>
                                </div>
                            </article>
                        <% }); %>
                    </div>
                <% } else { %>
                    <h2 class="city-name" id="cityName">–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞</h2>
                <% } %>
            </section>
        </div>
    </main>
</div>
<script>
    function showErrorToast(title = '–ü–æ–º–∏–ª–∫–∞', message = '–©–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫', duration = 5000) {
        const container = document.getElementById('errorToastContainer');

        const toast = document.createElement('div');
        toast.className = 'error-toast';

        toast.innerHTML = `
                <div class="error-icon">‚ùå</div>
                <div class="error-content">
                    <div class="error-title">${title}</div>
                    <div class="error-message">${message}</div>
                </div>
                <button class="error-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">
                    <svg viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
                <div class="error-progress"></div>
            `;

        container.appendChild(toast);

        requestAnimationFrame(() => {
            toast.classList.add('show');
        });

        const closeToast = () => {
            toast.classList.remove('show');
            toast.classList.add('hide');

            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 400);
        };

        const closeBtn = toast.querySelector('.error-close');
        closeBtn.addEventListener('click', closeToast);

        if (duration > 0) {
            setTimeout(closeToast, duration);
        }

        let timeoutId;
        toast.addEventListener('mouseenter', () => {
            const progressBar = toast.querySelector('.error-progress');
            if (progressBar) {
                progressBar.style.animationPlayState = 'paused';
            }
        });

        toast.addEventListener('mouseleave', () => {
            const progressBar = toast.querySelector('.error-progress');
            if (progressBar) {
                progressBar.style.animationPlayState = 'running';
            }
        });

        return toast;
    }

    window.addEventListener("DOMContentLoaded", () => {
        const serverError = '<%= typeof error !== "undefined" ? error : "" %>';

        if (serverError && serverError.trim() !== '') {
            showErrorToast('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö', serverError, 6000);
        }
    });
</script>
</body>
</html>